<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC Analysis Automator - Inventory Classification Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 3em;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.3em;
            opacity: 0.9;
        }

        .upload-section {
            background: white;
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #f8f9fa;
        }

        .upload-area:hover {
            background: #e9ecef;
            border-color: #764ba2;
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            background: #e3f2fd;
            border-color: #2196f3;
        }

        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .upload-area h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .upload-area p {
            color: #666;
        }

        #fileInput {
            display: none;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.6);
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
        }

        .format-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }

        .info-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }

        .info-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .info-box code {
            display: block;
            background: #2d3748;
            color: #48bb78;
            padding: 15px;
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.8;
            margin: 10px 0;
            overflow-x: auto;
        }

        .info-box p {
            color: #4a5568;
            line-height: 1.8;
        }

        .error {
            background: #fff5f5;
            border: 2px solid #fc8181;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: 500;
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .metric-label {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .metric-sub {
            color: #a0aec0;
            font-size: 0.9em;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .chart-container h3 {
            margin-bottom: 20px;
            color: #2d3748;
            font-size: 1.3em;
        }

        .insights {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .insights h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .insight-card {
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 5px solid;
        }

        .insight-card.cat-a {
            background: #fff5f5;
            border-color: #f56565;
        }

        .insight-card.cat-b {
            background: #fffaf0;
            border-color: #ed8936;
        }

        .insight-card.cat-c {
            background: #f0fff4;
            border-color: #48bb78;
        }

        .insight-card strong {
            display: block;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .insight-card p {
            color: #4a5568;
            line-height: 1.6;
        }

        .table-container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .table-container h3 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #f7fafc;
            color: #2d3748;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #f7fafc;
        }

        .category-badge {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            display: inline-block;
            font-size: 0.9em;
        }

        .cat-a-badge {
            background: #fed7d7;
            color: #c53030;
        }

        .cat-b-badge {
            background: #feebc8;
            color: #c05621;
        }

        .cat-c-badge {
            background: #c6f6d5;
            color: #22543d;
        }

        .actions {
            text-align: center;
            margin: 30px 0;
        }

        @media (max-width: 768px) {
            .format-info,
            .charts-grid {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 2em;
            }

            .metric-value {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ABC Analysis Automator</h1>
            <p>Intelligent Inventory Classification System</p>
        </div>

        <div class="upload-section" id="uploadSection">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <h2>Drop CSV File Here or Click to Upload</h2>
                <p>Required columns: Part Name, Unit Price, Annual Consumption</p>
                <input type="file" id="fileInput" accept=".csv">
            </div>

            <div class="format-info">
                <div class="info-box">
                    <h3>ğŸ“‹ Required Format</h3>
                    <code>Part Name,Unit Price,Annual Consumption,Material Category<br>Bearing XYZ,150,2000,Mechanical<br>Bolt Type A,5,15000,Fasteners<br>Motor 5HP,3500,500,Electrical</code>
                    <p style="margin-top: 10px; color: #718096; font-size: 0.9em;">
                        <strong>Note:</strong> Material Category is optional. If not provided, all items will be classified as "General".
                    </p>
                    <button class="btn btn-success" onclick="downloadTemplate()">â¬‡ï¸ Download Template</button>
                </div>
                <div class="info-box">
                    <h3>â„¹ï¸ How It Works</h3>
                    <p>
                        1. Upload your inventory CSV file<br>
                        2. System calculates total value automatically<br>
                        3. Items categorized into A, B, C classes<br>
                        4. Get instant analytics and insights<br>
                        5. Export detailed results
                    </p>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-secondary" onclick="loadSampleData()">ğŸ”¬ Try with Sample Data</button>
            </div>

            <div id="error" class="error" style="display: none;"></div>
        </div>

        <div class="dashboard" id="dashboard">
            <div class="metrics" id="metrics"></div>

            <div class="charts-grid">
                <div class="chart-container">
                    <h3>ğŸ“Š Value Distribution by Category</h3>
                    <canvas id="pieChart"></canvas>
                </div>
                <div class="chart-container">
                    <h3>ğŸ“ˆ Item Count by Category</h3>
                    <canvas id="barChart"></canvas>
                </div>
            </div>

            <div class="insights" id="insights"></div>

            <div class="table-container">
                <h3>ğŸ“‹ Detailed Item Analysis</h3>
                <div class="actions" style="margin-bottom: 20px;">
                    <button class="btn btn-success" onclick="exportDetailedReport()">ğŸ“Š Export Full Report (HTML)</button>
                    <button class="btn btn-success" onclick="exportResults()">ğŸ“„ Export Data (CSV)</button>
                    <button class="btn btn-success" onclick="exportSummary()">ğŸ“‹ Export Summary (TXT)</button>
                    <button class="btn btn-secondary" onclick="resetTool()">ğŸ”„ Analyze New File</button>
                </div>
                <table id="resultsTable"></table>
            </div>
        </div>
    </div>

    <script>
        let analysisData = null;
        let pieChartInstance = null;
        let barChartInstance = null;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const errorDiv = document.getElementById('error');

        uploadArea.addEventListener('click', function() {
            fileInput.click();
        });

        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', function() {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) {
                handleFile(file);
            }
        });

        fileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        function handleFile(file) {
            if (!file.name.endsWith('.csv')) {
                showError('Please upload a CSV file');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    processCSV(e.target.result);
                } catch (err) {
                    showError(err.message);
                }
            };
            reader.readAsText(file);
        }

        function processCSV(content) {
            const lines = content.trim().split('\n');
            const headers = lines[0].split(',').map(function(h) {
                return h.trim();
            });

            const requiredHeaders = ['Part Name', 'Unit Price', 'Annual Consumption'];
            const hasRequired = requiredHeaders.every(function(h) {
                return headers.some(function(header) {
                    return header.toLowerCase() === h.toLowerCase();
                });
            });

            if (!hasRequired) {
                throw new Error('CSV must contain: Part Name, Unit Price, Annual Consumption');
            }

            const nameIndex = headers.findIndex(function(h) {
                return h.toLowerCase() === 'part name';
            });
            const priceIndex = headers.findIndex(function(h) {
                return h.toLowerCase() === 'unit price';
            });
            const consumptionIndex = headers.findIndex(function(h) {
                return h.toLowerCase() === 'annual consumption';
            });

            const items = [];
            for (let i = 1; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;

                const values = line.split(',').map(function(v) {
                    return v.trim();
                });

                const price = parseFloat(values[priceIndex]) || 0;
                const consumption = parseFloat(values[consumptionIndex]) || 0;
                const totalValue = price * consumption;

                if (totalValue > 0) {
                    items.push({
                        id: i - 1,
                        name: values[nameIndex] || 'Item ' + i,
                        unitPrice: price,
                        annualConsumption: consumption,
                        totalValue: totalValue
                    });
                }
            }

            if (items.length === 0) {
                throw new Error('No valid data found in CSV');
            }

            performABCAnalysis(items);
        }

        function performABCAnalysis(items) {
            items.sort(function(a, b) {
                return b.totalValue - a.totalValue;
            });

            let totalValue = 0;
            for (let i = 0; i < items.length; i++) {
                totalValue += items[i].totalValue;
            }

            let cumulative = 0;
            for (let i = 0; i < items.length; i++) {
                cumulative += items[i].totalValue;
                items[i].cumulativePercentage = (cumulative / totalValue) * 100;
                items[i].valuePercentage = (items[i].totalValue / totalValue) * 100;

                if (items[i].cumulativePercentage <= 70) {
                    items[i].category = 'A';
                } else if (items[i].cumulativePercentage <= 90) {
                    items[i].category = 'B';
                } else {
                    items[i].category = 'C';
                }
            }

            const stats = {
                A: { count: 0, value: 0, items: [] },
                B: { count: 0, value: 0, items: [] },
                C: { count: 0, value: 0, items: [] }
            };

            for (let i = 0; i < items.length; i++) {
                const cat = items[i].category;
                stats[cat].count++;
                stats[cat].value += items[i].totalValue;
                stats[cat].items.push(items[i]);
            }

            stats.A.percentage = (stats.A.value / totalValue) * 100;
            stats.A.countPercentage = (stats.A.count / items.length) * 100;
            stats.B.percentage = (stats.B.value / totalValue) * 100;
            stats.B.countPercentage = (stats.B.count / items.length) * 100;
            stats.C.percentage = (stats.C.value / totalValue) * 100;
            stats.C.countPercentage = (stats.C.count / items.length) * 100;

            analysisData = {
                items: items,
                stats: stats,
                totalValue: totalValue,
                totalItems: items.length
            };

            displayResults();
        }

        function displayResults() {
            errorDiv.style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('dashboard').classList.add('active');

            displayMetrics();
            displayCharts();
            displayInsights();
            displayTable();
        }

        function displayMetrics() {
            const stats = analysisData.stats;
            const totalValue = analysisData.totalValue;
            const totalItems = analysisData.totalItems;

            let html = '';
            html += '<div class="metric-card">';
            html += '<div class="metric-label">Total Items</div>';
            html += '<div class="metric-value">' + totalItems + '</div>';
            html += '<div class="metric-sub">SKUs in inventory</div>';
            html += '</div>';

            html += '<div class="metric-card">';
            html += '<div class="metric-label">Total Value</div>';
            html += '<div class="metric-value">â‚¹' + Math.round(totalValue / 1000) + 'K</div>';
            html += '<div class="metric-sub">' + formatCurrency(totalValue) + '</div>';
            html += '</div>';

            html += '<div class="metric-card">';
            html += '<div class="metric-label">Category A Items</div>';
            html += '<div class="metric-value">' + stats.A.count + '</div>';
            html += '<div class="metric-sub">' + stats.A.percentage.toFixed(1) + '% of total value</div>';
            html += '</div>';

            html += '<div class="metric-card">';
            html += '<div class="metric-label">Category B Items</div>';
            html += '<div class="metric-value">' + stats.B.count + '</div>';
            html += '<div class="metric-sub">' + stats.B.percentage.toFixed(1) + '% of total value</div>';
            html += '</div>';

            document.getElementById('metrics').innerHTML = html;
        }

        function displayCharts() {
            const stats = analysisData.stats;

            if (pieChartInstance) {
                pieChartInstance.destroy();
            }
            if (barChartInstance) {
                barChartInstance.destroy();
            }

            const pieCtx = document.getElementById('pieChart').getContext('2d');
            pieChartInstance = new Chart(pieCtx, {
                type: 'pie',
                data: {
                    labels: ['Category A', 'Category B', 'Category C'],
                    datasets: [{
                        data: [
                            stats.A.percentage,
                            stats.B.percentage,
                            stats.C.percentage
                        ],
                        backgroundColor: ['#f56565', '#ed8936', '#48bb78']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            const barCtx = document.getElementById('barChart').getContext('2d');
            barChartInstance = new Chart(barCtx, {
                type: 'bar',
                data: {
                    labels: ['Category A', 'Category B', 'Category C'],
                    datasets: [{
                        label: 'Item Count',
                        data: [stats.A.count, stats.B.count, stats.C.count],
                        backgroundColor: ['#f56565', '#ed8936', '#48bb78']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        function displayInsights() {
            const stats = analysisData.stats;
            let html = '<h3>ğŸ’¡ Key Insights</h3>';

            html += '<div class="insight-card cat-a">';
            html += '<strong style="color: #c53030;">ğŸ¯ Category A - Critical Items</strong>';
            html += '<p>' + stats.A.count + ' items (' + stats.A.countPercentage.toFixed(1) + '% of inventory) represent ' + stats.A.percentage.toFixed(1) + '% of total value. These require tight control, accurate records, and frequent monitoring.</p>';
            html += '</div>';

            html += '<div class="insight-card cat-b">';
            html += '<strong style="color: #c05621;">âš ï¸ Category B - Important Items</strong>';
            html += '<p>' + stats.B.count + ' items (' + stats.B.countPercentage.toFixed(1) + '% of inventory) represent ' + stats.B.percentage.toFixed(1) + '% of total value. Moderate control and good records needed with regular review cycles.</p>';
            html += '</div>';

            html += '<div class="insight-card cat-c">';
            html += '<strong style="color: #22543d;">âœ“ Category C - Standard Items</strong>';
            html += '<p>' + stats.C.count + ' items (' + stats.C.countPercentage.toFixed(1) + '% of inventory) represent ' + stats.C.percentage.toFixed(1) + '% of total value. Simple controls and periodic review sufficient.</p>';
            html += '</div>';

            document.getElementById('insights').innerHTML = html;
        }

        function displayTable() {
            const items = analysisData.items;
            let html = '<thead><tr>';
            html += '<th>Part Name</th>';
            html += '<th style="text-align: right;">Unit Price</th>';
            html += '<th style="text-align: right;">Annual Qty</th>';
            html += '<th style="text-align: right;">Total Value</th>';
            html += '<th style="text-align: right;">Value %</th>';
            html += '<th style="text-align: center;">Category</th>';
            html += '</tr></thead><tbody>';

            const displayItems = items.slice(0, 20);
            for (let i = 0; i < displayItems.length; i++) {
                const item = displayItems[i];
                const badgeClass = 'cat-' + item.category.toLowerCase() + '-badge';
                html += '<tr>';
                html += '<td>' + item.name + '</td>';
                html += '<td style="text-align: right;">' + formatCurrency(item.unitPrice) + '</td>';
                html += '<td style="text-align: right;">' + item.annualConsumption.toLocaleString() + '</td>';
                html += '<td style="text-align: right;"><strong>' + formatCurrency(item.totalValue) + '</strong></td>';
                html += '<td style="text-align: right;">' + item.valuePercentage.toFixed(2) + '%</td>';
                html += '<td style="text-align: center;"><span class="category-badge ' + badgeClass + '">' + item.category + '</span></td>';
                html += '</tr>';
            }

            html += '</tbody>';

            if (items.length > 20) {
                html += '<tfoot><tr><td colspan="6" style="text-align: center; color: #718096; padding: 20px;">';
                html += 'Showing top 20 of ' + items.length + ' items. Download full report for complete analysis.';
                html += '</td></tr></tfoot>';
            }

            document.getElementById('resultsTable').innerHTML = html;
        }

        function formatCurrency(value) {
            return 'â‚¹' + value.toLocaleString('en-IN', {
                maximumFractionDigits: 0
            });
        }

        function exportDetailedReport() {
            const items = analysisData.items;
            const stats = analysisData.stats;
            const totalValue = analysisData.totalValue;
            const totalItems = analysisData.totalItems;
            
            // Get chart images
            const pieChart = document.getElementById('pieChart');
            const barChart = document.getElementById('barChart');
            const pieImage = pieChart.toDataURL('image/png');
            const barImage = barChart.toDataURL('image/png');
            
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-IN');
            
            let html = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABC Analysis Report - ${dateStr}</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 40px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 40px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            border-bottom: 4px solid #667eea;
            padding-bottom: 30px;
            margin-bottom: 40px;
        }
        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header p {
            color: #718096;
            font-size: 1.2em;
        }
        .summary-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 40px;
        }
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        .summary-item {
            text-align: center;
        }
        .summary-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }
        .summary-value {
            font-size: 2em;
            font-weight: bold;
        }
        .charts-section {
            margin: 40px 0;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 20px;
        }
        .chart-box {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .chart-box h3 {
            color: #2d3748;
            margin-bottom: 15px;
        }
        .chart-box img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        .category-analysis {
            margin: 40px 0;
        }
        .category-card {
            margin: 20px 0;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid;
        }
        .category-card.cat-a {
            background: #fff5f5;
            border-color: #f56565;
        }
        .category-card.cat-b {
            background: #fffaf0;
            border-color: #ed8936;
        }
        .category-card.cat-c {
            background: #f0fff4;
            border-color: #48bb78;
        }
        .category-card h3 {
            margin-bottom: 15px;
            font-size: 1.4em;
        }
        .category-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin: 15px 0;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }
        .stat-item {
            text-align: center;
        }
        .stat-label {
            font-size: 0.9em;
            color: #718096;
            margin-bottom: 5px;
        }
        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2d3748;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 30px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        th {
            background: #f7fafc;
            color: #2d3748;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85em;
        }
        tr:hover {
            background: #f7fafc;
        }
        .badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 0.85em;
        }
        .badge-a { background: #fed7d7; color: #c53030; }
        .badge-b { background: #feebc8; color: #c05621; }
        .badge-c { background: #c6f6d5; color: #22543d; }
        .insights {
            margin: 40px 0;
            padding: 30px;
            background: #edf2f7;
            border-radius: 10px;
        }
        .insights h2 {
            color: #2d3748;
            margin-bottom: 20px;
        }
        .insights ul {
            list-style: none;
            padding: 0;
        }
        .insights li {
            padding: 10px 0;
            color: #4a5568;
            line-height: 1.6;
        }
        .insights li:before {
            content: "âœ“ ";
            color: #48bb78;
            font-weight: bold;
            margin-right: 10px;
        }
        .footer {
            margin-top: 50px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
            text-align: center;
            color: #718096;
        }
        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š ABC Analysis Report</h1>
            <p>Inventory Classification & Analytics</p>
            <p style="font-size: 0.9em; margin-top: 10px;">Generated on ${dateStr}</p>
        </div>

        <div class="summary-box">
            <h2 style="margin-bottom: 20px;">Executive Summary</h2>
            <div class="summary-grid">
                <div class="summary-item">
                    <div class="summary-label">Total Items</div>
                    <div class="summary-value">${totalItems}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Total Value</div>
                    <div class="summary-value">${formatCurrency(totalValue)}</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Category A</div>
                    <div class="summary-value">${stats.A.count}</div>
                    <div class="summary-label" style="margin-top: 5px;">${stats.A.percentage.toFixed(1)}% Value</div>
                </div>
                <div class="summary-item">
                    <div class="summary-label">Category B</div>
                    <div class="summary-value">${stats.B.count}</div>
                    <div class="summary-label" style="margin-top: 5px;">${stats.B.percentage.toFixed(1)}% Value</div>
                </div>
            </div>
        </div>

        <div class="charts-section">
            <h2 style="color: #2d3748; margin-bottom: 20px;">Visual Analytics</h2>
            <div class="charts-grid">
                <div class="chart-box">
                    <h3>Value Distribution by Category</h3>
                    <img src="${pieImage}" alt="Pie Chart">
                    <p style="margin-top: 15px; color: #718096;">
                        A: ${stats.A.percentage.toFixed(1)}% | 
                        B: ${stats.B.percentage.toFixed(1)}% | 
                        C: ${stats.C.percentage.toFixed(1)}%
                    </p>
                </div>
                <div class="chart-box">
                    <h3>Item Count by Category</h3>
                    <img src="${barImage}" alt="Bar Chart">
                    <p style="margin-top: 15px; color: #718096;">
                        A: ${stats.A.count} items | 
                        B: ${stats.B.count} items | 
                        C: ${stats.C.count} items
                    </p>
                </div>
            </div>
        </div>

        <div class="category-analysis">
            <h2 style="color: #2d3748; margin-bottom: 20px;">Category-wise Analysis</h2>
            
            <div class="category-card cat-a">
                <h3 style="color: #c53030;">ğŸ¯ Category A - Critical Items</h3>
                <div class="category-stats">
                    <div class="stat-item">
                        <div class="stat-label">Item Count</div>
                        <div class="stat-value">${stats.A.count}</div>
                        <div class="stat-label">${stats.A.countPercentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Value</div>
                        <div class="stat-value">${formatCurrency(stats.A.value)}</div>
                        <div class="stat-label">${stats.A.percentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Avg. Item Value</div>
                        <div class="stat-value">${formatCurrency(stats.A.value / stats.A.count)}</div>
                    </div>
                </div>
                <p style="color: #4a5568; margin-top: 15px; line-height: 1.6;">
                    <strong>Management Strategy:</strong> These items require tight inventory control, 
                    accurate records, frequent monitoring, and strong supplier relationships. 
                    Focus 80% of management attention here.
                </p>
            </div>

            <div class="category-card cat-b">
                <h3 style="color: #c05621;">âš ï¸ Category B - Important Items</h3>
                <div class="category-stats">
                    <div class="stat-item">
                        <div class="stat-label">Item Count</div>
                        <div class="stat-value">${stats.B.count}</div>
                        <div class="stat-label">${stats.B.countPercentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Value</div>
                        <div class="stat-value">${formatCurrency(stats.B.value)}</div>
                        <div class="stat-label">${stats.B.percentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Avg. Item Value</div>
                        <div class="stat-value">${formatCurrency(stats.B.value / stats.B.count)}</div>
                    </div>
                </div>
                <p style="color: #4a5568; margin-top: 15px; line-height: 1.6;">
                    <strong>Management Strategy:</strong> Moderate control with good records needed. 
                    Regular review cycles and reasonable safety stock levels. Balance between 
                    cost and service level.
                </p>
            </div>

            <div class="category-card cat-c">
                <h3 style="color: #22543d;">âœ“ Category C - Standard Items</h3>
                <div class="category-stats">
                    <div class="stat-item">
                        <div class="stat-label">Item Count</div>
                        <div class="stat-value">${stats.C.count}</div>
                        <div class="stat-label">${stats.C.countPercentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Value</div>
                        <div class="stat-value">${formatCurrency(stats.C.value)}</div>
                        <div class="stat-label">${stats.C.percentage.toFixed(1)}% of total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Avg. Item Value</div>
                        <div class="stat-value">${formatCurrency(stats.C.value / stats.C.count)}</div>
                    </div>
                </div>
                <p style="color: #4a5568; margin-top: 15px; line-height: 1.6;">
                    <strong>Management Strategy:</strong> Simple controls and periodic review 
                    sufficient. Higher safety stock acceptable. Can use min-max or two-bin systems. 
                    Least management attention required.
                </p>
            </div>
        </div>

        <div class="insights">
            <h2>ğŸ’¡ Key Insights & Recommendations</h2>
            <ul>
                <li><strong>Pareto Principle Applied:</strong> ${stats.A.countPercentage.toFixed(0)}% of items (Category A) contribute ${stats.A.percentage.toFixed(0)}% of total inventory value.</li>
                <li><strong>Focus Area:</strong> Prioritize Category A items for demand forecasting, supplier negotiations, and inventory optimization.</li>
                <li><strong>Cost Reduction Opportunity:</strong> Category A items offer the highest potential for cost savings through bulk purchasing and better terms.</li>
                <li><strong>Safety Stock Strategy:</strong> Maintain minimal safety stock for A items (tight control), moderate for B items, and higher for C items (lower cost impact).</li>
                <li><strong>Review Frequency:</strong> Daily/Weekly reviews for A items, Monthly for B items, Quarterly for C items.</li>
                <li><strong>Supplier Management:</strong> Develop strategic partnerships with suppliers of Category A items.</li>
                <li><strong>Storage Optimization:</strong> Store Category A items in most accessible locations for quick access and accurate tracking.</li>
            </ul>
        </div>

        <h2 style="color: #2d3748; margin: 40px 0 20px 0;">Complete Item Analysis</h2>
        <table>
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Part Name</th>
                    <th style="text-align: right;">Unit Price</th>
                    <th style="text-align: right;">Annual Qty</th>
                    <th style="text-align: right;">Total Value</th>
                    <th style="text-align: right;">Value %</th>
                    <th style="text-align: right;">Cumulative %</th>
                    <th style="text-align: center;">Category</th>
                </tr>
            </thead>
            <tbody>`;

            items.forEach(function(item, index) {
                const badgeClass = 'badge badge-' + item.category.toLowerCase();
                html += `
                <tr>
                    <td>${index + 1}</td>
                    <td>${item.name}</td>
                    <td style="text-align: right;">${formatCurrency(item.unitPrice)}</td>
                    <td style="text-align: right;">${item.annualConsumption.toLocaleString()}</td>
                    <td style="text-align: right;"><strong>${formatCurrency(item.totalValue)}</strong></td>
                    <td style="text-align: right;">${item.valuePercentage.toFixed(2)}%</td>
                    <td style="text-align: right;">${item.cumulativePercentage.toFixed(2)}%</td>
                    <td style="text-align: center;"><span class="${badgeClass}">${item.category}</span></td>
                </tr>`;
            });

            html += `
            </tbody>
        </table>

        <div class="footer">
            <p><strong>ABC Analysis Automator</strong></p>
            <p>This report was generated automatically using the Pareto Principle (80/20 rule)</p>
            <p style="margin-top: 10px; font-size: 0.9em;">Generated on ${dateStr}</p>
        </div>
    </div>
</body>
</html>`;

            const blob = new Blob([html], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const timestamp = today.getFullYear() + '-' + 
                            (today.getMonth() + 1) + '-' + 
                            today.getDate();
            a.download = 'ABC_Analysis_Full_Report_' + timestamp + '.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportSummary() {
            const stats = analysisData.stats;
            const totalValue = analysisData.totalValue;
            const totalItems = analysisData.totalItems;
            const today = new Date();
            const dateStr = today.toLocaleDateString('en-IN');

            let text = 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            text += '              ABC ANALYSIS SUMMARY REPORT\n';
            text += '         Inventory Classification & Analytics\n';
            text += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n';
            text += 'Generated: ' + dateStr + '\n\n';

            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'EXECUTIVE SUMMARY\n';
            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'Total Items Analyzed: ' + totalItems + '\n';
            text += 'Total Inventory Value: ' + formatCurrency(totalValue) + '\n\n';

            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'CATEGORY DISTRIBUTION\n';
            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n';

            text += 'ğŸ¯ CATEGORY A - CRITICAL ITEMS\n';
            text += '   Item Count: ' + stats.A.count + ' (' + stats.A.countPercentage.toFixed(1) + '% of total items)\n';
            text += '   Total Value: ' + formatCurrency(stats.A.value) + ' (' + stats.A.percentage.toFixed(1) + '% of total value)\n';
            text += '   Avg Item Value: ' + formatCurrency(stats.A.value / stats.A.count) + '\n';
            text += '   Strategy: Tight control, frequent monitoring, accurate records\n\n';

            text += 'âš ï¸  CATEGORY B - IMPORTANT ITEMS\n';
            text += '   Item Count: ' + stats.B.count + ' (' + stats.B.countPercentage.toFixed(1) + '% of total items)\n';
            text += '   Total Value: ' + formatCurrency(stats.B.value) + ' (' + stats.B.percentage.toFixed(1) + '% of total value)\n';
            text += '   Avg Item Value: ' + formatCurrency(stats.B.value / stats.B.count) + '\n';
            text += '   Strategy: Moderate control, regular review cycles\n\n';

            text += 'âœ“ CATEGORY C - STANDARD ITEMS\n';
            text += '   Item Count: ' + stats.C.count + ' (' + stats.C.countPercentage.toFixed(1) + '% of total items)\n';
            text += '   Total Value: ' + formatCurrency(stats.C.value) + ' (' + stats.C.percentage.toFixed(1) + '% of total value)\n';
            text += '   Avg Item Value: ' + formatCurrency(stats.C.value / stats.C.count) + '\n';
            text += '   Strategy: Simple controls, periodic review\n\n';

            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'KEY INSIGHTS\n';
            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'âœ“ Pareto Principle: ' + stats.A.countPercentage.toFixed(0) + '% of items = ' + stats.A.percentage.toFixed(0) + '% of value\n';
            text += 'âœ“ Focus 80% attention on Category A items\n';
            text += 'âœ“ Category A offers highest cost reduction potential\n';
            text += 'âœ“ Review frequency: A=Daily/Weekly, B=Monthly, C=Quarterly\n';
            text += 'âœ“ Develop strategic supplier partnerships for A items\n\n';

            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n';
            text += 'TOP 10 HIGH-VALUE ITEMS\n';
            text += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\n\n';

            const top10 = analysisData.items.slice(0, 10);
            top10.forEach(function(item, index) {
                text += (index + 1) + '. ' + item.name + '\n';
                text += '   Value: ' + formatCurrency(item.totalValue) + ' | ';
                text += 'Category: ' + item.category + ' | ';
                text += 'Contribution: ' + item.valuePercentage.toFixed(2) + '%\n\n';
            });

            text += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';
            text += 'End of Report\n';
            text += 'â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n';

            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const timestamp = today.getFullYear() + '-' + 
                            (today.getMonth() + 1) + '-' + 
                            today.getDate();
            a.download = 'ABC_Analysis_Summary_' + timestamp + '.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportResults() {
            const items = analysisData.items;
            let csv = 'Part Name,Unit Price,Annual Consumption,Total Value,Value %,Cumulative %,ABC Category\n';

            for (let i = 0; i < items.length; i++) {
                const item = items[i];
                csv += '"' + item.name + '",';
                csv += item.unitPrice + ',';
                csv += item.annualConsumption + ',';
                csv += item.totalValue.toFixed(2) + ',';
                csv += item.valuePercentage.toFixed(2) + ',';
                csv += item.cumulativePercentage.toFixed(2) + ',';
                csv += item.category + '\n';
            }

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const today = new Date();
            const dateStr = today.getFullYear() + '-' + 
                          (today.getMonth() + 1) + '-' + 
                          today.getDate();
            a.download = 'abc_analysis_results_' + dateStr + '.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function downloadTemplate() {
            const template = 'Part Name,Unit Price,Annual Consumption\n';
            const sampleData = 'Bearing XYZ,150,2000\nBolt Type A,5,15000\nMotor 5HP,3500,500\nScrew M6,0.5,50000\nPump Assembly,8000,200\nValve 2 inch,450,1200\nGasket Set,75,3000';
            
            const blob = new Blob([template + sampleData], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'abc_analysis_template.csv';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadSampleData() {
            const sampleCSV = 'Part Name,Unit Price,Annual Consumption\n' +
                'Industrial Motor 10HP,45000,120\n' +
                'Bearing SKF 6205,850,2500\n' +
                'Hydraulic Pump Assembly,125000,45\n' +
                'Steel Bolt M12x80,15,25000\n' +
                'Conveyor Belt 1200mm,32000,85\n' +
                'Pressure Gauge 0-10bar,1200,450\n' +
                'Safety Valve 2 inch,8500,180\n' +
                'Gearbox Reducer 1:40,95000,35\n' +
                'Control Panel Assembly,150000,28\n' +
                'Pneumatic Cylinder 50mm,12000,220\n' +
                'V-Belt B Section,450,1800\n' +
                'Electric Cable 4 core,180,5500\n' +
                'Coupling Flexible 50mm,3200,380\n' +
                'Oil Seal 45x62x7,85,8500\n' +
                'Filter Element Hydraulic,650,1200';

            try {
                processCSV(sampleCSV);
            } catch (err) {
                showError(err.message);
            }
        }

        function resetTool() {
            location.reload();
        }

        function showError(message) {
            errorDiv.textContent = 'âŒ Error: ' + message;
            errorDiv.style.display = 'block';
        }
    </script>
</body>
</html>